---
title: typed-es
description: D√©tecter les types de sorties de vos requ√™tes elasticsearch automatiquement.
datePublished: 2025-08-01
---

tldr: [https://github.com/Vahor/typed-es](https://github.com/Vahor/typed-es)

## Pourquoi cette librairie ?

Actuellement avec la librairie node elasticsearch, lorsqu'on fait une requ√™te search, on a des types de retour tr√®s minces. Les `_souce` sont de type `unknown`. Il n'y a aucune s√©curit√© sur les champs ou non d'index.
Le seul moyen d'ajouter quelques types est de tout d√©clarer manuellement.

```typescript
const result = await client.search<
  { id: number; name: string },
  { categories: { buckets: Array<{ key: string; doc_count: number }> } }
>(query);
```

Mais rien n'assure que les types sont correctes ni √† jour par rapport √† la requ√™te..


## La solution

**typed-es** g√©n√®re automatiquement des types pr√©cis √† partir de la requ√™te Elasticsearch.

```typescript

type Indexes = {
    products: {
        id: number;
        name: string;
        price: number;
        category: string;
        created_at: string;
    },
    users: {
        id: number;
        first_name: string;
        last_name: string;
        email: string;
    }
};

const query = typedEs(client, {
    index: "products",
    _source: ["*_at", "price"],
    track_total_hits: true,
    rest_total_hits_as_int: true,
    aggs: {
        categories: { terms: { field: "category" } }
    }
});

const result = await client.search(query);
const total = result.hits.total; // number
const firstHit = result.hits.hits[0]._source; // { price: number; created_at: string }
const categories = result.aggregations.categories.buckets;  // Array<{ key: unknown; doc_count: number; }>
```

üéâ Types parfaitement inf√©r√©s, sans d√©claration manuelle

### Fonctionnalit√©s

